<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RedKill â€” Rename Foto Online (Preview â†’ Download)</title>

<!-- JSZip + FileSaver -->
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

<style>
  :root{
    --bg:#f4f4f4; /* ubah ke background terang */
    --card:#ffffff;
    --accent:#ff4d6d; /* warna cerah */
    --accent-2:#ff7f91;
    --muted:#333;
    --glass: rgba(255,255,255,0.3);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
    background: var(--bg);
    color: var(--muted);
    padding:28px;
    display:flex;
    align-items:flex-start;
    justify-content:center;
    min-height:100vh;
  }

  .container{
    width:1100px; max-width:96%;
    background: var(--card);
    border-radius:16px;
    padding:20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
  }

  header{
    display:flex; gap:14px; align-items:center; margin-bottom:14px;
  }
  .logo{
    width:64px; height:64px; border-radius:12px;
    background: linear-gradient(135deg,var(--accent),var(--accent-2));
    display:flex; align-items:center; justify-content:center;
    color:#fff; font-weight:800; font-size:20px; box-shadow:0 6px 20px rgba(0,0,0,0.1);
  }
  h1{ margin:0; font-size:20px; color:var(--muted); letter-spacing:0.2px }
  p.lead{margin:0; color:#555; opacity:0.9; font-size:13px}

  .grid{
    display:grid;
    grid-template-columns: 360px 1fr;
    gap:18px;
    margin-top:16px;
  }

  .panel{
    background: var(--card);
    border-radius:12px;
    padding:12px;
    border:1px solid #ddd;
  }

  .drop{
    border:2px dashed #ccc;
    border-radius:10px;
    padding:12px;
    text-align:center;
    background: #fafafa;
  }
  .drop.dragover{ border-color: var(--accent); box-shadow:0 4px 20px rgba(255,77,109,0.2) inset; }

  .btn{
    display:inline-block; padding:10px 14px; background:var(--accent); color:#fff; border-radius:10px; cursor:pointer; border:0;
    font-weight:700; box-shadow: 0 4px 20px rgba(255,77,109,0.2);
  }
  .btn.secondary{ background:transparent; border:1px solid #ccc; color:var(--muted); padding:8px 12px; font-weight:600 }
  .small{ font-size:13px; color:#666; margin-top:8px }

  textarea#names{
    width:100%; min-height:220px; resize:vertical; padding:10px; border-radius:8px; border:1px solid #ccc;
    background: #fff; color:var(--muted); font-family:monospace; font-size:13px;
  }

  .right{
    display:flex; flex-direction:column; gap:12px;
  }
  .toolbar{ display:flex; gap:8px; align-items:center; justify-content:space-between }
  .info{ font-size:13px; color:#666; }

  .preview{
    background: #fff;
    border-radius:12px; padding:12px; border:1px solid #ddd;
    min-height:240px; max-height:520px; overflow:auto;
  }

  table { width:100%; border-collapse:collapse; color:var(--muted); }
  th,td{ padding:8px 10px; font-size:13px; border-bottom:1px solid #eee; vertical-align:middle; }
  th{ text-align:left; font-weight:700; font-size:13px }
  td.namecell input{ width:100%; padding:6px; border-radius:6px; border:1px solid #ccc; background:#fff; color:var(--muted); font-family:monospace }

  .thumb{ width:64px; height:48px; object-fit:cover; border-radius:6px; border:1px solid #ccc }

  .progressOuter{ background: #eee; border-radius:8px; height:12px; overflow:hidden; width:100%; margin-top:6px }
  .progressBar{ height:100%; width:0%; background: linear-gradient(90deg,var(--accent),var(--accent-2)); transition: width .25s ease; }

  .foot{ margin-top:6px; display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap }
  .muted{ color:#888; font-size:13px }

  .tag{ display:inline-block; background:rgba(255,77,109,0.1); color:var(--accent); padding:6px 8px; border-radius:8px; font-weight:700; font-size:13px; border:1px solid rgba(255,77,109,0.2) }

  @media (max-width:980px){
    .grid{ grid-template-columns: 1fr; }
    .container{ padding:12px }
    .logo{ width:56px; height:56px }
  }
</style>
</head>
<body>
<div class="container">
  <header>
    <div class="logo">RK</div>
    <div>
      <h1>RedKill â€” Rename Foto (Preview â†’ Download)</h1>
      <p class="lead">Upload foto â†’ paste nama baru â†’ preview â†’ download ZIP. Hasil aman & rapi.</p>
    </div>
  </header>

  <div class="grid">
    <div class="panel">
      <div class="drop" id="dropzone">
        <div style="margin-bottom:8px"><strong>Drag & Drop foto</strong> atau <span class="btn" id="pickBtn">Pilih File</span></div>
        <div class="small">Dukungan: .jpg .jpeg .png .webp .gif (ekstensi dipertahankan).</div>
        <input type="file" id="fileInput" multiple accept="image/*" style="display:none">
      </div>

      <div style="margin-top:12px; display:flex; gap:10px; align-items:center">
        <label style="font-weight:700">Daftar Nama</label>
        <button class="btn secondary" id="importNamesBtn">Import .txt</button>
        <input type="file" id="namesFile" accept=".txt" style="display:none">
      </div>

      <textarea id="names" placeholder="TL999&#10;TL0890&#10;TL1200"></textarea>
      <div class="small">Gunakan tombol <em>Preview Mapping</em> sebelum download.</div>
    </div>

    <div class="right">
      <div class="panel toolbar">
        <div style="display:flex; gap:10px; align-items:center">
          <button class="btn" id="previewBtn">ðŸ”Ž Preview Mapping</button>
          <button class="btn" id="downloadBtn" disabled>ðŸ“¦ Download ZIP</button>
          <button class="btn secondary" id="clearBtn">Clear All</button>
        </div>
        <div class="info">
          <span class="tag" id="fileCount">0 files</span>
        </div>
      </div>

      <div class="panel preview" id="previewArea">
        <div id="emptyHint" style="text-align:center; opacity:0.7; padding:30px 10px;">
          Belum ada file. Drop foto di kiri.
        </div>
        <div id="mappingTableWrap" style="display:none">
          <table id="mappingTable">
            <thead><tr><th style="width:72px">Preview</th><th>Original</th><th>New name</th><th style="width:120px">Size</th></tr></thead>
            <tbody id="mappingBody"></tbody>
          </table>
        </div>

        <div style="margin-top:8px">
          <div class="progressOuter"><div id="prog" class="progressBar"></div></div>
          <div class="foot">
            <div class="muted" id="statusText">Ready.</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
let files = [];
const fileInput = document.getElementById('fileInput');
const pickBtn = document.getElementById('pickBtn');
const dropzone = document.getElementById('dropzone');
const namesArea = document.getElementById('names');
const previewBtn = document.getElementById('previewBtn');
const downloadBtn = document.getElementById('downloadBtn');
const mappingBody = document.getElementById('mappingBody');
const mappingTableWrap = document.getElementById('mappingTableWrap');
const emptyHint = document.getElementById('emptyHint');
const fileCountTag = document.getElementById('fileCount');
const prog = document.getElementById('prog');
const statusText = document.getElementById('statusText');
const importNamesBtn = document.getElementById('importNamesBtn');
const namesFile = document.getElementById('namesFile');
const clearBtn = document.getElementById('clearBtn');

pickBtn.addEventListener('click', ()=> fileInput.click());
fileInput.addEventListener('change', handlePick);
namesFile.addEventListener('change', handleNamesImport);
importNamesBtn.addEventListener('click', ()=> namesFile.click());
clearBtn.addEventListener('click', clearAll);

dropzone.addEventListener('dragenter', e=>{ e.preventDefault(); dropzone.classList.add('dragover'); });
dropzone.addEventListener('dragover', e=>{ e.preventDefault(); });
dropzone.addEventListener('dragleave', e=>{ dropzone.classList.remove('dragover'); });
dropzone.addEventListener('drop', e=>{ e.preventDefault(); dropzone.classList.remove('dragover'); handleDrop(e); });

function handlePick(e){ addFiles(Array.from(e.target.files || [])); fileInput.value=''; }
function handleDrop(e){ addFiles(Array.from(e.dataTransfer.files || [])); }

function addFiles(list){
  const images = list.filter(f => f.type && f.type.startsWith('image/'));
  if(images.length === 0){ alert('Pilih file gambar.'); return; }
  images.forEach(f=> files.push({file:f, url:URL.createObjectURL(f)}));
  updateUI();
}

function updateUI(){
  fileCountTag.textContent = `${files.length} files`;
  emptyHint.style.display = files.length>0?'none':'block';
  mappingTableWrap.style.display = files.length>0?'block':'none';

  if(files.length>0){
    mappingBody.innerHTML='';
    files.forEach((f,i)=>{
      const tr=document.createElement('tr');
      const thumbTd=document.createElement('td');
      const img=document.createElement('img'); img.className='thumb'; img.src=f.url;
      thumbTd.appendChild(img);

      const origTd=document.createElement('td'); origTd.textContent=f.file.name;

      const newTd=document.createElement('td'); newTd.className='namecell';
      const input=document.createElement('input'); input.type='text'; input.value=stripExt(f.file.name); input.dataset.index=i;
      newTd.appendChild(input);

      const sizeTd=document.createElement('td'); sizeTd.textContent=readableBytes(f.file.size);

      tr.appendChild(thumbTd); tr.appendChild(origTd); tr.appendChild(newTd); tr.appendChild(sizeTd);
      mappingBody.appendChild(tr);
    });
  }
  downloadBtn.disabled=true;
}

function stripExt(name){ const idx=name.lastIndexOf('.'); return idx===-1?name:name.slice(0,idx); }
function readableBytes(n){ if(n<1024)return n+' B'; if(n<1024*1024)return Math.round(n/1024)+' KB'; return Math.round(n/(1024*1024))+' MB'; }

function handleNamesImport(e){
  const f=e.target.files[0]; if(!f) return;
  const rdr=new FileReader();
  rdr.onload=()=>{ namesArea.value = rdr.result.replace(/\r\n/g,'\n'); };
  rdr.readAsText(f,'utf8');
  namesFile.value='';
}

previewBtn.addEventListener('click', ()=>{
  if(files.length===0){ alert('Belum ada file. Pilih file dulu.'); return; }
  const txt = namesArea.value.trim();
  const rows = mappingBody.querySelectorAll('tr');
  if(txt.length>0){
    const names = txt.split(/\r?\n/).map(s=>s.trim()).filter(s=>s!=='');
    rows.forEach((row,i)=>{ if(names[i]) row.querySelector('input').value = names[i]; });
  }
  downloadBtn.disabled=false;
  statusText.textContent='Preview siap â€” cek mapping di tabel.';
});

downloadBtn.addEventListener('click', async ()=>{
  const rows = mappingBody.querySelectorAll('tr');
  const newNames=[];
  for(let i=0;i<rows.length;i++){
    let nm=rows[i].querySelector('input').value.trim();
    if(nm==='') nm=stripExt(files[i].file.name);
    newNames.push(nm);
  }

  const used={};
  for(let i=0;i<newNames.length;i++){
    const ext=getExt(files[i].file.name);
    let candidate=newNames[i]+(ext?'.'+ext:''); let k=1;
    while(used[candidate.toLowerCase()]){ candidate=newNames[i]+'_'+k+(ext?'.'+ext:''); k++; }
    used[candidate.toLowerCase()]=true;
    newNames[i]=candidate;
  }

  const zip=new JSZip(); const log=[];
  prog.style.width='0%'; statusText.textContent='Memproses file ke ZIP...';
  downloadBtn.disabled=true; previewBtn.disabled=true;

  for(let i=0;i<files.length;i++){
    const f=files[i].file; const outName=newNames[i];
    statusText.textContent=`Memproses ${i+1}/${files.length}: ${f.name} â†’ ${outName}`;
    try{ const arr=await f.arrayBuffer(); zip.file(outName,arr); log.push({original:f.name,renamed:outName,size:f.size}); }
    catch(err){ alert('Error membaca file: '+f.name); downloadBtn.disabled=false; previewBtn.disabled=false; return; }
    prog.style.width=Math.round(((i+1)/files.length)*100)+'%';
    await new Promise(r=>setTimeout(r,20));
  }

  const csvLines=['original,renamed,size_bytes']; log.forEach(l=>csvLines.push(`"${l.original}","${l.renamed}",${l.size}`));
  zip.file('rename_log.csv',csvLines.join('\n'));

  const blob=await zip.generateAsync({type:'blob'});
  saveAs(blob,'redkill_renamed_photos.zip');
  statusText.textContent='Selesai â€” ZIP didownload.';
  prog.style.width='100%';
  downloadBtn.disabled=false; previewBtn.disabled=false;
});

function getExt(name){ const idx=name.lastIndexOf('.'); return idx===-1?'':name.slice(idx+1); }

function clearAll(){ files.forEach(f=>URL.revokeObjectURL(f.url)); files=[]; mappingBody.innerHTML=''; mappingTableWrap.style.display='none'; emptyHint.style.display='block'; fileCountTag.textContent='0 files'; namesArea.value=''; prog.style.width='0%'; statusText.textContent='Cleared.'; downloadBtn.disabled=true; }
</script>
</body>
</html>
