<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RedKill ‚Äî Rename Foto Online (Preview ‚Üí Download)</title>

<!-- JSZip + FileSaver -->
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

<style>
  :root{
    --bg:#0b0203;
    --card:#13060a;
    --accent:#ff1f3a; /* redkill accent */
    --accent-2:#ff5a6a;
    --muted:#cfc7c9;
    --glass: rgba(255,255,255,0.04);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
    background: radial-gradient(1200px 600px at 10% 10%, rgba(255,31,58,0.06), transparent 6%),
                linear-gradient(180deg,#050001 0%, #0d0204 100%);
    color:var(--muted);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:28px;
    display:flex;
    align-items:flex-start;
    justify-content:center;
    min-height:100vh;
  }

  .container{
    width:1100px; max-width:96%;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.03);
    box-shadow: 0 10px 40px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
    border-radius:16px;
    padding:20px;
  }

  header{
    display:flex; gap:14px; align-items:center; margin-bottom:14px;
  }
  .logo{
    width:64px; height:64px; border-radius:12px;
    background: linear-gradient(135deg,var(--accent),var(--accent-2));
    display:flex; align-items:center; justify-content:center;
    color:#fff; font-weight:800; font-size:20px; box-shadow:0 6px 30px rgba(255,31,58,0.15);
  }
  h1{ margin:0; font-size:20px; color:#ffdfe2; letter-spacing:0.2px }
  p.lead{margin:0; color:#f5d6d8; opacity:0.9; font-size:13px}

  .grid{
    display:grid;
    grid-template-columns: 360px 1fr;
    gap:18px;
    margin-top:16px;
  }

  /* left panel */
  .panel{
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
    border-radius:12px;
    padding:12px;
    border:1px solid rgba(255,255,255,0.02);
  }
  .drop{
    border:2px dashed rgba(255,255,255,0.04);
    border-radius:10px;
    padding:12px;
    text-align:center;
    background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
  }
  .drop.dragover{ border-color: rgba(255,31,58,0.8); box-shadow:0 8px 30px rgba(255,31,58,0.04) inset; }

  .btn{
    display:inline-block; padding:10px 14px; background:var(--accent); color:#fff; border-radius:10px; cursor:pointer; border:0;
    font-weight:700; box-shadow: 0 8px 30px rgba(255,31,58,0.12);
  }
  .btn.secondary{ background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--muted); padding:8px 12px; font-weight:600 }
  .small{ font-size:13px; color:#cfaeb2; margin-top:8px }

  textarea#names{
    width:100%; min-height:220px; resize:vertical; padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.03);
    background: rgba(0,0,0,0.3); color:var(--muted); font-family:monospace; font-size:13px;
  }

  /* right panel */
  .right{
    display:flex; flex-direction:column; gap:12px;
  }
  .toolbar{ display:flex; gap:8px; align-items:center; justify-content:space-between }
  .info{ font-size:13px; color:#eec; }

  .preview{
    background: linear-gradient(180deg, rgba(0,0,0,0.25), rgba(255,255,255,0.01));
    border-radius:12px; padding:12px; border:1px solid rgba(255,255,255,0.02);
    min-height:240px; max-height:520px; overflow:auto;
  }

  table { width:100%; border-collapse:collapse; color:var(--muted); }
  th,td{ padding:8px 10px; font-size:13px; border-bottom:1px dashed rgba(255,255,255,0.02); vertical-align:middle; }
  th{ text-align:left; color:#ffd7db; font-weight:700; font-size:13px }
  td.namecell input{ width:100%; padding:6px; border-radius:6px; border:1px solid rgba(255,255,255,0.03); background:transparent; color:var(--muted); font-family:monospace }

  .thumb{ width:64px; height:48px; object-fit:cover; border-radius:6px; border:1px solid rgba(255,255,255,0.03) }

  .progressOuter{ background: rgba(255,255,255,0.02); border-radius:8px; height:12px; overflow:hidden; width:100%; margin-top:6px }
  .progressBar{ height:100%; width:0%; background: linear-gradient(90deg,var(--accent),var(--accent-2)); transition: width .25s ease; }

  .foot{ margin-top:6px; display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap }
  .muted{ color:#bba9ab; font-size:13px }

  .tag{ display:inline-block; background:rgba(255,31,58,0.08); color:var(--accent); padding:6px 8px; border-radius:8px; font-weight:700; font-size:13px; border:1px solid rgba(255,31,58,0.06) }

  /* responsive */
  @media (max-width:980px){
    .grid{ grid-template-columns: 1fr; }
    .container{ padding:12px }
    .logo{ width:56px; height:56px }
  }
</style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">RK</div>
      <div>
        <h1>RedKill ‚Äî Rename Foto (Preview ‚Üí Download)</h1>
        <p class="lead">Upload foto ‚Üí paste nama baru (1 baris = 1 foto) ‚Üí preview mapping ‚Üí download ZIP. Hasil aman & rapi.</p>
      </div>
    </header>

    <div class="grid">
      <div class="panel">
        <div class="drop" id="dropzone">
          <div style="margin-bottom:8px"><strong>Drag & Drop foto</strong> atau <span class="btn" id="pickBtn">Pilih File</span></div>
          <div class="small">Dukungan: .jpg .jpeg .png .webp .gif (ekstensi akan dipertahankan). Urutan sesuai urutan upload/pilih.</div>
          <input type="file" id="fileInput" multiple accept="image/*" style="display:none">
        </div>

        <div style="margin-top:12px; display:flex; gap:10px; align-items:center">
          <label style="font-weight:700">Daftar Nama (manual)</label>
          <button class="btn secondary" id="importNamesBtn">Import .txt</button>
          <input type="file" id="namesFile" accept=".txt" style="display:none">
        </div>

        <textarea id="names" placeholder="Contoh:
TL999
TL0890
TL1200
... (satu nama per baris)"></textarea>

        <div class="small">Tip: gunakan tombol <em>Preview Mapping</em> untuk melihat hasil sebelum di-download.</div>
      </div>

      <div class="right">
        <div class="panel toolbar">
          <div style="display:flex; gap:10px; align-items:center">
            <button class="btn" id="previewBtn">üîé Preview Mapping</button>
            <button class="btn" id="downloadBtn" disabled>üì¶ Download ZIP</button>
            <button class="btn secondary" id="clearBtn">Clear All</button>
          </div>
          <div class="info">
            <span class="tag" id="fileCount">0 files</span>
          </div>
        </div>

        <div class="panel preview" id="previewArea">
          <div id="emptyHint" style="text-align:center; opacity:0.7; padding:30px 10px;">
            Belum ada file. Drop foto di kiri, lalu paste daftar nama manual di kiri bawah.
          </div>
          <div id="mappingTableWrap" style="display:none">
            <table id="mappingTable">
              <thead><tr><th style="width:72px">Preview</th><th>Original</th><th>New name (editable)</th><th style="width:120px">Size</th></tr></thead>
              <tbody id="mappingBody"></tbody>
            </table>
          </div>

          <div style="margin-top:8px">
            <div class="progressOuter"><div id="prog" class="progressBar"></div></div>
            <div class="foot">
              <div class="muted" id="statusText">Ready.</div>
              <div style="display:flex; gap:8px; align-items:center">
                <div class="muted">Theme:</div>
                <div style="color:#ffd1d4; font-weight:700">RedKill</div>
              </div>
            </div>
          </div>
        </div>

        <div style="margin-top:8px; text-align:right; color:#d3b6b8; font-size:12px">
          Made with ‚ù§Ô∏è ‚Äî RedKill Edition
        </div>
      </div>
    </div>
  </div>

<script>
/* RedKill Rename ‚Äî client side only */
let files = []; // {file, url}
const fileInput = document.getElementById('fileInput');
const pickBtn = document.getElementById('pickBtn');
const dropzone = document.getElementById('dropzone');
const namesArea = document.getElementById('names');
const previewBtn = document.getElementById('previewBtn');
const downloadBtn = document.getElementById('downloadBtn');
const mappingBody = document.getElementById('mappingBody');
const mappingTableWrap = document.getElementById('mappingTableWrap');
const emptyHint = document.getElementById('emptyHint');
const fileCountTag = document.getElementById('fileCount');
const prog = document.getElementById('prog');
const statusText = document.getElementById('statusText');
const importNamesBtn = document.getElementById('importNamesBtn');
const namesFile = document.getElementById('namesFile');
const clearBtn = document.getElementById('clearBtn');

pickBtn.addEventListener('click', ()=> fileInput.click());
fileInput.addEventListener('change', handlePick);
namesFile.addEventListener('change', handleNamesImport);
importNamesBtn.addEventListener('click', ()=> namesFile.click());
clearBtn.addEventListener('click', clearAll);

dropzone.addEventListener('dragenter', (e)=>{ e.preventDefault(); dropzone.classList.add('dragover'); });
dropzone.addEventListener('dragover', (e)=>{ e.preventDefault(); });
dropzone.addEventListener('dragleave', (e)=>{ dropzone.classList.remove('dragover'); });
dropzone.addEventListener('drop', (e)=>{ e.preventDefault(); dropzone.classList.remove('dragover'); handleDrop(e); });

function handlePick(e){
  const chosen = Array.from(e.target.files || []);
  addFiles(chosen);
  fileInput.value = '';
}
function handleDrop(e){
  const dt = e.dataTransfer;
  const chosen = Array.from(dt.files || []);
  addFiles(chosen);
}

function addFiles(list){
  const images = list.filter(f => f.type && f.type.startsWith('image/'));
  if(images.length === 0) {
    alert('Pilih file gambar (jpg/png/webp/gif).');
    return;
  }
  // maintain order as selected
  images.forEach(f=>{
    const obj = { file: f, url: URL.createObjectURL(f) };
    files.push(obj);
  });
  updateUI();
}

function updateUI(){
  fileCountTag.textContent = `${files.length} files`;
  if(files.length>0){
    emptyHint.style.display='none';
    mappingTableWrap.style.display='block';
  } else {
    emptyHint.style.display='block';
    mappingTableWrap.style.display='none';
  }
  // rebuild table minimally (but not names)
  if(files.length > 0) {
    if(mappingBody.children.length === 0) { // no previous mapping -> create rows
      mappingBody.innerHTML = '';
      for(let i=0;i<files.length;i++){
        const f = files[i].file;
        const tr = document.createElement('tr');
        const thumbTd = document.createElement('td');
        const img = document.createElement('img'); img.className='thumb'; img.src = files[i].url;
        thumbTd.appendChild(img);

        const origTd = document.createElement('td'); origTd.textContent = f.name;

        const newTd = document.createElement('td'); newTd.className='namecell';
        const input = document.createElement('input'); input.type='text'; input.value = stripExt(f.name); input.dataset.index = i;
        input.title = "Edit nama baru (tanpa ekstensi)";
        newTd.appendChild(input);

        const sizeTd = document.createElement('td'); sizeTd.textContent = readableBytes(f.size);

        tr.appendChild(thumbTd); tr.appendChild(origTd); tr.appendChild(newTd); tr.appendChild(sizeTd);
        mappingBody.appendChild(tr);
      }
    } else {
      // if rows exist, only update preview thumbnails and original names
      const rows = mappingBody.querySelectorAll('tr');
      rows.forEach((row,i)=>{
        const f = files[i].file;
        row.children[0].querySelector('img').src = files[i].url;
        row.children[1].textContent = f.name;
        row.children[3].textContent = readableBytes(f.size);
        // keep editable new name as-is
      });
    }
  }
  downloadBtn.disabled = true;
}

function stripExt(name){
  const idx = name.lastIndexOf('.');
  if(idx === -1) return name;
  return name.slice(0, idx);
}

function readableBytes(n){
  if(n<1024) return n+' B';
  if(n<1024*1024) return Math.round(n/1024)+' KB';
  return Math.round(n/(1024*1024)) + ' MB';
}

/* import names from txt */
function handleNamesImport(e){
  const f = e.target.files[0];
  if(!f) return;
  const rdr = new FileReader();
  rdr.onload = function(){ namesArea.value = rdr.result.replace(/\r\n/g,'\n'); };
  rdr.readAsText(f, 'utf8');
  namesFile.value = '';
}

/* Preview mapping */
previewBtn.addEventListener('click', ()=> {
  if(files.length === 0){ alert('Belum ada file. Pilih file dulu.'); return; }
  // build names from textarea OR from inputs if user already edited
  const txt = namesArea.value.trim();
  const rows = mappingBody.querySelectorAll('tr');
  let names = [];
  if(txt.length > 0){
    names = txt.split(/\r?\n/).map(s=>s.trim()).filter(s=>s!=='');
    if(names.length < files.length){
      if(!confirm(`Jumlah nama (${names.length}) lebih sedikit dari jumlah file (${files.length}). Lanjutkan dan kosongkan sisanya?`)){
        return;
      }
    }
    // apply to inputs
    rows.forEach((row,i)=>{
      const inp = row.querySelector('input');
      if(names[i]) inp.value = names[i];
    });
  } else {
    // take input values as is
    // nothing to do
  }

  // refresh table and enable download
  downloadBtn.disabled = false;
  statusText.textContent = 'Preview siap ‚Äî cek mapping di tabel (bisa di-edit nama baru).';
});

/* Download ZIP */
downloadBtn.addEventListener('click', async ()=> {
  // collect current names from inputs
  const rows = mappingBody.querySelectorAll('tr');
  const newNames = [];
  for(let i=0;i<rows.length;i++){
    const inp = rows[i].querySelector('input');
    let nm = inp.value.trim();
    if(nm==='') {
      nm = stripExt(files[i].file.name); // fallback
      inp.value = nm;
    }
    newNames.push(nm);
  }

  // ensure unique filenames (avoid collisions)
  const used = {};
  for(let i=0;i<newNames.length;i++){
    const ext = getExt(files[i].file.name);
    let candidate = newNames[i] + (ext?'.'+ext:'');
    let k=1;
    while(used[candidate.toLowerCase()]){
      candidate = newNames[i] + '_' + k + (ext?'.'+ext:'');
      k++;
    }
    used[candidate.toLowerCase()] = true;
    newNames[i] = candidate;
  }

  // start zipping sequentially
  const zip = new JSZip();
  const log = [];
  prog.style.width = '0%';
  statusText.textContent = 'Memproses file ke ZIP...';
  downloadBtn.disabled = true;
  previewBtn.disabled = true;

  for(let i=0;i<files.length;i++){
    const f = files[i].file;
    const outName = newNames[i];
    statusText.textContent = `Memproses ${i+1}/${files.length}: ${f.name} ‚Üí ${outName}`;
    try{
      const arr = await f.arrayBuffer();
      zip.file(outName, arr);
      log.push({original: f.name, renamed: outName, size: f.size});
    }catch(err){
      console.error('read error', err);
      alert('Error membaca file: ' + f.name);
      downloadBtn.disabled = false;
      previewBtn.disabled = false;
      return;
    }
    prog.style.width = Math.round(((i+1)/files.length)*45) + '%';
    await new Promise(r=>setTimeout(r, 40)); // keep UI responsive
  }

  // add log csv
  const csvLines = ['original,renamed,size_bytes'];
  log.forEach(l=> csvLines.push(`"${l.original}","${l.renamed}",${l.size}`));
  zip.file('rename_log.csv', csvLines.join('\n'));

  statusText.textContent = 'Menyusun ZIP (finalizing)...';
  const blob = await zip.generateAsync({type:'blob'}, meta=>{
    prog.style.width = 45 + Math.round(meta.percent*0.55) + '%';
  });

  saveAs(blob, 'redkill_renamed_photos.zip');
  statusText.textContent = 'Selesai ‚Äî ZIP didownload.';
  prog.style.width = '100%';
  downloadBtn.disabled = false;
  previewBtn.disabled = false;
});

/* helper */
function getExt(name){
  const idx = name.lastIndexOf('.');
  if(idx === -1) return '';
  return name.slice(idx+1);
}

/* clear */
function clearAll(){
  // revoke urls
  files.forEach(f=> URL.revokeObjectURL(f.url));
  files = [];
  mappingBody.innerHTML = '';
  mappingTableWrap.style.display = 'none';
  emptyHint.style.display = 'block';
  fileCountTag.textContent = '0 files';
  namesArea.value = '';
  prog.style.width = '0%';
  statusText.textContent = 'Cleared.';
  downloadBtn.disabled = true;
}

/* initial */
(function init(){
  // nothing special
})();
</script>
</body>
</html>
